{"ast":null,"code":"var _jsxFileName = \"/Users/ago/rails-react-app/frontend/src/components/pages/Studies.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Grid, Typography } from \"@material-ui/core\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Button from \"@material-ui/core/Button\";\nimport Divider from \"@material-ui/core/Divider\";\nimport FavoriteIcon from \"@material-ui/icons/Favorite\";\nimport FavoriteBorderIcon from \"@material-ui/icons/FavoriteBorder\";\nimport AlertMessage from \"components/utils/AlertMessage\";\nimport { prefectures } from \"data/prefectures\";\nimport { getUsers } from \"lib/api/users\";\nimport { getLikes, createLike } from \"lib/api/likes\";\nimport { AuthContext } from \"App\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  avatar: {\n    width: theme.spacing(10),\n    height: theme.spacing(10)\n  }\n})); // ユーザー一覧ページ\n\nconst Studies = () => {\n  _s();\n\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const classes = useStyles();\n  const initialUserState = {\n    id: 0,\n    uid: \"\",\n    provider: \"\",\n    email: \"\",\n    name: \"\",\n    image: {\n      url: \"\"\n    },\n    gender: 0,\n    birthday: \"\",\n    profile: \"\",\n    prefecture: 13,\n    allowPasswordChange: true\n  };\n  const [loading, setLoading] = useState(true);\n  const [users, setUsers] = useState([]);\n  const [user, setUser] = useState(initialUserState);\n  const [userDetailOpen, setUserDetailOpen] = useState(false);\n  const [likedUsers, setLikedUsers] = useState([]);\n  const [likes, setLikes] = useState([]);\n  const [alertMessageOpen, setAlertMessageOpen] = useState(false); // 生年月日から年齢を計算する 年齢 = floor((今日 - 誕生日) / 10000)\n\n  const userAge = () => {\n    const birthday = user.birthday.toString().replace(/-/g, \"\");\n    if (birthday.length !== 8) return;\n    const date = new Date();\n    const today = date.getFullYear() + (\"0\" + (date.getMonth() + 1)).slice(-2) + (\"0\" + date.getDate()).slice(-2);\n    return Math.floor((parseInt(today) - parseInt(birthday)) / 10000);\n  }; // 都道府県\n\n\n  const userPrefecture = () => {\n    return prefectures[user.prefecture - 1];\n  }; // いいね作成\n\n\n  const handleCreateLike = async user => {\n    const data = {\n      fromUserId: currentUser === null || currentUser === void 0 ? void 0 : currentUser.id,\n      toUserId: user.id\n    };\n\n    try {\n      const res = await createLike(data);\n      console.log(res);\n\n      if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n        setLikes([res.data.like, ...likes]);\n        setLikedUsers([user, ...likedUsers]);\n        console.log(res === null || res === void 0 ? void 0 : res.data.like);\n      } else {\n        console.log(\"Failed\");\n      }\n\n      if ((res === null || res === void 0 ? void 0 : res.data.isMatched) === true) {\n        setAlertMessageOpen(true);\n        setUserDetailOpen(false);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }; // ユーザー一覧を取得\n\n\n  const handleGetUsers = async () => {\n    try {\n      const res = await getUsers();\n      console.log(res);\n\n      if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n        setUsers(res === null || res === void 0 ? void 0 : res.data.users);\n      } else {\n        console.log(\"No users\");\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    setLoading(false);\n  }; // いいね一覧を取得\n\n\n  const handleGetLikes = async () => {\n    try {\n      const res = await getLikes();\n      console.log(res);\n\n      if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n        setLikedUsers(res === null || res === void 0 ? void 0 : res.data.activeLikes);\n      } else {\n        console.log(\"No likes\");\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(() => {\n    handleGetUsers();\n    handleGetLikes();\n  }, []); // すでにいいねを押されているユーザーかどうかの判定\n\n  const isLikedUser = userId => {\n    return likedUsers === null || likedUsers === void 0 ? void 0 : likedUsers.some(likedUser => likedUser.id === userId);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [!loading ? (users === null || users === void 0 ? void 0 : users.length) > 0 ? /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      justify: \"center\",\n      children: users === null || users === void 0 ? void 0 : users.map((user, index) => {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => {\n            setUser(user);\n            setUserDetailOpen(true);\n          },\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            style: {\n              margin: \"0.5rem\",\n              cursor: \"pointer\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              alt: \"avatar\",\n              src: user === null || user === void 0 ? void 0 : user.image.url,\n              className: classes.avatar\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              component: \"p\",\n              gutterBottom: true,\n              style: {\n                marginTop: \"0.5rem\",\n                textAlign: \"center\"\n              },\n              children: user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 23\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 21\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n      component: \"p\",\n      variant: \"body2\",\n      color: \"textSecondary\",\n      children: \"\\u307E\\u30601\\u4EBA\\u3082\\u30E6\\u30FC\\u30B6\\u30FC\\u304C\\u3044\\u307E\\u305B\\u3093\\u3002\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: userDetailOpen,\n      keepMounted: true,\n      onClose: () => setUserDetailOpen(false),\n      children: /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          justify: \"center\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Avatar, {\n              alt: \"avatar\",\n              src: user === null || user === void 0 ? void 0 : user.image.url,\n              className: classes.avatar\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          justify: \"center\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            style: {\n              marginTop: \"1rem\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body1\",\n              component: \"p\",\n              gutterBottom: true,\n              style: {\n                textAlign: \"center\"\n              },\n              children: [user.name, \" \", userAge(), \"\\u6B73 (\", userPrefecture(), \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              component: \"p\",\n              gutterBottom: true,\n              style: {\n                marginTop: \"0.5rem\",\n                fontWeight: \"bold\"\n              },\n              children: \"\\u81EA\\u5DF1\\u7D39\\u4ECB\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              component: \"p\",\n              color: \"textSecondary\",\n              style: {\n                marginTop: \"0.5rem\"\n              },\n              children: user.profile ? user.profile : \"よろしくお願いします。\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: () => isLikedUser(user.id) ? void 0 : handleCreateLike(user),\n            color: \"secondary\",\n            startIcon: isLikedUser(user.id) ? /*#__PURE__*/_jsxDEV(FavoriteIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 49\n            }, this) : /*#__PURE__*/_jsxDEV(FavoriteBorderIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 68\n            }, this),\n            disabled: isLikedUser(user.id) ? true : false,\n            style: {\n              marginTop: \"1rem\",\n              marginBottom: \"1rem\"\n            },\n            children: isLikedUser(user.id) ? \"いいね済み\" : \"いいね\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            container: true,\n            justify: \"center\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              component: Link,\n              to: \"/\",\n              variant: \"outlined\",\n              color: \"secondary\",\n              children: \" \\u5B66\\u7FD2\\u5185\\u5BB9\\u3092\\u78BA\\u8A8D\\u3059\\u308B\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 242,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AlertMessage, {\n      open: alertMessageOpen,\n      setOpen: setAlertMessageOpen,\n      severity: \"success\",\n      message: \"\\u30DE\\u30C3\\u30C1\\u30F3\\u30B0\\u304C\\u6210\\u7ACB\\u3057\\u307E\\u3057\\u305F!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Studies, \"mHohhMHe/ejXyil2coCwzdjIPAo=\", false, function () {\n  return [useStyles];\n});\n\n_c = Studies;\nexport default Studies;\n\nvar _c;\n\n$RefreshReg$(_c, \"Studies\");","map":{"version":3,"sources":["/Users/ago/rails-react-app/frontend/src/components/pages/Studies.tsx"],"names":["React","useState","useEffect","useContext","Link","makeStyles","Grid","Typography","Dialog","DialogContent","Avatar","Button","Divider","FavoriteIcon","FavoriteBorderIcon","AlertMessage","prefectures","getUsers","getLikes","createLike","AuthContext","useStyles","theme","avatar","width","spacing","height","Studies","currentUser","classes","initialUserState","id","uid","provider","email","name","image","url","gender","birthday","profile","prefecture","allowPasswordChange","loading","setLoading","users","setUsers","user","setUser","userDetailOpen","setUserDetailOpen","likedUsers","setLikedUsers","likes","setLikes","alertMessageOpen","setAlertMessageOpen","userAge","toString","replace","length","date","Date","today","getFullYear","getMonth","slice","getDate","Math","floor","parseInt","userPrefecture","handleCreateLike","data","fromUserId","toUserId","res","console","log","status","like","isMatched","err","handleGetUsers","handleGetLikes","activeLikes","isLikedUser","userId","some","likedUser","map","index","margin","cursor","marginTop","textAlign","fontWeight","marginBottom"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,UAArC,QAAuD,OAAvD;AACA,SAASC,IAAT,QAAqB,kBAArB;AAEA,SAASC,UAAT,QAAkC,0BAAlC;AACA,SAASC,IAAT,EAAeC,UAAf,QAAiC,mBAAjC;AAEA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,aAAP,MAA0B,iCAA1B;AAEA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,OAAP,MAAoB,2BAApB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,kBAAP,MAA+B,mCAA/B;AAEA,OAAOC,YAAP,MAAyB,+BAAzB;AAEA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,QAAT,QAAyB,eAAzB;AACA,SAASC,QAAT,EAAmBC,UAAnB,QAAqC,eAArC;AAGA,SAASC,WAAT,QAA4B,KAA5B;;;AAEA,MAAMC,SAAS,GAAGhB,UAAU,CAAEiB,KAAD,KAAmB;AAC9CC,EAAAA,MAAM,EAAE;AACNC,IAAAA,KAAK,EAAEF,KAAK,CAACG,OAAN,CAAc,EAAd,CADD;AAENC,IAAAA,MAAM,EAAEJ,KAAK,CAACG,OAAN,CAAc,EAAd;AAFF;AADsC,CAAnB,CAAD,CAA5B,C,CAOA;;AACA,MAAME,OAAiB,GAAG,MAAM;AAAA;;AAC9B,QAAM;AAAEC,IAAAA;AAAF,MAAkBzB,UAAU,CAACiB,WAAD,CAAlC;AACA,QAAMS,OAAO,GAAGR,SAAS,EAAzB;AAEA,QAAMS,gBAAsB,GAAG;AAC7BC,IAAAA,EAAE,EAAE,CADyB;AAE7BC,IAAAA,GAAG,EAAE,EAFwB;AAG7BC,IAAAA,QAAQ,EAAE,EAHmB;AAI7BC,IAAAA,KAAK,EAAE,EAJsB;AAK7BC,IAAAA,IAAI,EAAE,EALuB;AAM7BC,IAAAA,KAAK,EAAE;AACLC,MAAAA,GAAG,EAAE;AADA,KANsB;AAS7BC,IAAAA,MAAM,EAAE,CATqB;AAU7BC,IAAAA,QAAQ,EAAE,EAVmB;AAW7BC,IAAAA,OAAO,EAAE,EAXoB;AAY7BC,IAAAA,UAAU,EAAE,EAZiB;AAa7BC,IAAAA,mBAAmB,EAAE;AAbQ,GAA/B;AAgBA,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwB3C,QAAQ,CAAU,IAAV,CAAtC;AACA,QAAM,CAAC4C,KAAD,EAAQC,QAAR,IAAoB7C,QAAQ,CAAS,EAAT,CAAlC;AACA,QAAM,CAAC8C,IAAD,EAAOC,OAAP,IAAkB/C,QAAQ,CAAO6B,gBAAP,CAAhC;AACA,QAAM,CAACmB,cAAD,EAAiBC,iBAAjB,IAAsCjD,QAAQ,CAAU,KAAV,CAApD;AACA,QAAM,CAACkD,UAAD,EAAaC,aAAb,IAA8BnD,QAAQ,CAAS,EAAT,CAA5C;AACA,QAAM,CAACoD,KAAD,EAAQC,QAAR,IAAoBrD,QAAQ,CAAS,EAAT,CAAlC;AACA,QAAM,CAACsD,gBAAD,EAAmBC,mBAAnB,IAA0CvD,QAAQ,CAAU,KAAV,CAAxD,CA1B8B,CA4B9B;;AACA,QAAMwD,OAAO,GAAG,MAAqB;AACnC,UAAMlB,QAAQ,GAAGQ,IAAI,CAACR,QAAL,CAAcmB,QAAd,GAAyBC,OAAzB,CAAiC,IAAjC,EAAuC,EAAvC,CAAjB;AACA,QAAIpB,QAAQ,CAACqB,MAAT,KAAoB,CAAxB,EAA2B;AAE3B,UAAMC,IAAI,GAAG,IAAIC,IAAJ,EAAb;AACA,UAAMC,KAAK,GAAGF,IAAI,CAACG,WAAL,KAAqB,CAAC,OAAOH,IAAI,CAACI,QAAL,KAAkB,CAAzB,CAAD,EAA8BC,KAA9B,CAAoC,CAAC,CAArC,CAArB,GAA+D,CAAC,MAAML,IAAI,CAACM,OAAL,EAAP,EAAuBD,KAAvB,CAA6B,CAAC,CAA9B,CAA7E;AAEA,WAAOE,IAAI,CAACC,KAAL,CAAW,CAACC,QAAQ,CAACP,KAAD,CAAR,GAAkBO,QAAQ,CAAC/B,QAAD,CAA3B,IAAyC,KAApD,CAAP;AACD,GARD,CA7B8B,CAuC9B;;;AACA,QAAMgC,cAAc,GAAG,MAAc;AACnC,WAAOvD,WAAW,CAAE+B,IAAI,CAACN,UAAN,GAAoB,CAArB,CAAlB;AACD,GAFD,CAxC8B,CA4C9B;;;AACA,QAAM+B,gBAAgB,GAAG,MAAOzB,IAAP,IAAsB;AAC7C,UAAM0B,IAAU,GAAG;AACjBC,MAAAA,UAAU,EAAE9C,WAAF,aAAEA,WAAF,uBAAEA,WAAW,CAAEG,EADR;AAEjB4C,MAAAA,QAAQ,EAAE5B,IAAI,CAAChB;AAFE,KAAnB;;AAKA,QAAI;AACF,YAAM6C,GAAG,GAAG,MAAMzD,UAAU,CAACsD,IAAD,CAA5B;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;;AAEA,UAAI,CAAAA,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEG,MAAL,MAAgB,GAApB,EAAyB;AACvBzB,QAAAA,QAAQ,CAAC,CAACsB,GAAG,CAACH,IAAJ,CAASO,IAAV,EAAgB,GAAG3B,KAAnB,CAAD,CAAR;AACAD,QAAAA,aAAa,CAAC,CAACL,IAAD,EAAO,GAAGI,UAAV,CAAD,CAAb;AAEA0B,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,aAAYA,GAAZ,uBAAYA,GAAG,CAAEH,IAAL,CAAUO,IAAtB;AACD,OALD,MAKO;AACLH,QAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACD;;AAED,UAAI,CAAAF,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEH,IAAL,CAAUQ,SAAV,MAAwB,IAA5B,EAAkC;AAChCzB,QAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACAN,QAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACD;AACF,KAjBD,CAiBE,OAAOgC,GAAP,EAAY;AACZL,MAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD;AACF,GA1BD,CA7C8B,CAyE9B;;;AACA,QAAMC,cAAc,GAAG,YAAY;AACjC,QAAI;AACF,YAAMP,GAAG,GAAG,MAAM3D,QAAQ,EAA1B;AACA4D,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;;AAEA,UAAI,CAAAA,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEG,MAAL,MAAgB,GAApB,EAAyB;AACvBjC,QAAAA,QAAQ,CAAC8B,GAAD,aAACA,GAAD,uBAACA,GAAG,CAAEH,IAAL,CAAU5B,KAAX,CAAR;AACD,OAFD,MAEO;AACLgC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACD;AACF,KATD,CASE,OAAOI,GAAP,EAAY;AACZL,MAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD;;AAEDtC,IAAAA,UAAU,CAAC,KAAD,CAAV;AACD,GAfD,CA1E8B,CA2F9B;;;AACA,QAAMwC,cAAc,GAAG,YAAY;AACjC,QAAI;AACF,YAAMR,GAAG,GAAG,MAAM1D,QAAQ,EAA1B;AACA2D,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;;AAEA,UAAI,CAAAA,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEG,MAAL,MAAgB,GAApB,EAAyB;AACvB3B,QAAAA,aAAa,CAACwB,GAAD,aAACA,GAAD,uBAACA,GAAG,CAAEH,IAAL,CAAUY,WAAX,CAAb;AACD,OAFD,MAEO;AACLR,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACD;AACF,KATD,CASE,OAAOI,GAAP,EAAY;AACZL,MAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD;AACF,GAbD;;AAeAhF,EAAAA,SAAS,CAAC,MAAM;AACdiF,IAAAA,cAAc;AACdC,IAAAA,cAAc;AACf,GAHQ,EAGN,EAHM,CAAT,CA3G8B,CAgH9B;;AACA,QAAME,WAAW,GAAIC,MAAD,IAAyC;AAC3D,WAAOpC,UAAP,aAAOA,UAAP,uBAAOA,UAAU,CAAEqC,IAAZ,CAAkBC,SAAD,IAAqBA,SAAS,CAAC1D,EAAV,KAAiBwD,MAAvD,CAAP;AACD,GAFD;;AAIA,sBACE;AAAA,eAEI,CAAC5C,OAAD,GACE,CAAAE,KAAK,SAAL,IAAAA,KAAK,WAAL,YAAAA,KAAK,CAAEe,MAAP,IAAgB,CAAhB,gBACE,QAAC,IAAD;AAAM,MAAA,SAAS,MAAf;AAAgB,MAAA,OAAO,EAAC,QAAxB;AAAA,gBAEIf,KAFJ,aAEIA,KAFJ,uBAEIA,KAAK,CAAE6C,GAAP,CAAW,CAAC3C,IAAD,EAAa4C,KAAb,KAA+B;AACxC,4BACE;AAAiB,UAAA,OAAO,EAAE,MAAM;AAC9B3C,YAAAA,OAAO,CAACD,IAAD,CAAP;AACAG,YAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACD,WAHD;AAAA,iCAIE,QAAC,IAAD;AAAM,YAAA,IAAI,MAAV;AAAW,YAAA,KAAK,EAAE;AAAE0C,cAAAA,MAAM,EAAE,QAAV;AAAoBC,cAAAA,MAAM,EAAE;AAA5B,aAAlB;AAAA,oCACE,QAAC,MAAD;AACE,cAAA,GAAG,EAAC,QADN;AAEE,cAAA,GAAG,EAAE9C,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEX,KAAN,CAAYC,GAFnB;AAGE,cAAA,SAAS,EAAER,OAAO,CAACN;AAHrB;AAAA;AAAA;AAAA;AAAA,oBADF,eAME,QAAC,UAAD;AACE,cAAA,OAAO,EAAC,OADV;AAEE,cAAA,SAAS,EAAC,GAFZ;AAGE,cAAA,YAAY,MAHd;AAIE,cAAA,KAAK,EAAE;AAAEuE,gBAAAA,SAAS,EAAE,QAAb;AAAuBC,gBAAAA,SAAS,EAAE;AAAlC,eAJT;AAAA,wBAMGhD,IAAI,CAACZ;AANR;AAAA;AAAA;AAAA;AAAA,oBANF;AAAA;AAAA;AAAA;AAAA;AAAA;AAJF,WAAUwD,KAAV;AAAA;AAAA;AAAA;AAAA,gBADF;AAsBD,OAvBD;AAFJ;AAAA;AAAA;AAAA;AAAA,YADF,gBA8BE,QAAC,UAAD;AACE,MAAA,SAAS,EAAC,GADZ;AAEE,MAAA,OAAO,EAAC,OAFV;AAGE,MAAA,KAAK,EAAC,eAHR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YA/BJ,gBAwCE,qCA1CN,eA6CE,QAAC,MAAD;AACE,MAAA,IAAI,EAAE1C,cADR;AAEE,MAAA,WAAW,MAFb;AAGE,MAAA,OAAO,EAAE,MAAMC,iBAAiB,CAAC,KAAD,CAHlC;AAAA,6BAKE,QAAC,aAAD;AAAA,gCACE,QAAC,IAAD;AAAM,UAAA,SAAS,MAAf;AAAgB,UAAA,OAAO,EAAC,QAAxB;AAAA,iCACE,QAAC,IAAD;AAAM,YAAA,IAAI,MAAV;AAAA,mCACE,QAAC,MAAD;AACE,cAAA,GAAG,EAAC,QADN;AAEE,cAAA,GAAG,EAAEH,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEX,KAAN,CAAYC,GAFnB;AAGE,cAAA,SAAS,EAAER,OAAO,CAACN;AAHrB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAUE,QAAC,IAAD;AAAM,UAAA,SAAS,MAAf;AAAgB,UAAA,OAAO,EAAC,QAAxB;AAAA,iCACE,QAAC,IAAD;AAAM,YAAA,IAAI,MAAV;AAAW,YAAA,KAAK,EAAE;AAAEuE,cAAAA,SAAS,EAAE;AAAb,aAAlB;AAAA,oCACE,QAAC,UAAD;AAAY,cAAA,OAAO,EAAC,OAApB;AAA4B,cAAA,SAAS,EAAC,GAAtC;AAA0C,cAAA,YAAY,MAAtD;AAAuD,cAAA,KAAK,EAAE;AAAEC,gBAAAA,SAAS,EAAE;AAAb,eAA9D;AAAA,yBACGhD,IAAI,CAACZ,IADR,OACesB,OAAO,EADtB,cAC6Bc,cAAc,EAD3C;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAIE,QAAC,OAAD;AAAA;AAAA;AAAA;AAAA,oBAJF,eAKE,QAAC,UAAD;AACE,cAAA,OAAO,EAAC,OADV;AAEE,cAAA,SAAS,EAAC,GAFZ;AAGE,cAAA,YAAY,MAHd;AAIE,cAAA,KAAK,EAAE;AAAEuB,gBAAAA,SAAS,EAAE,QAAb;AAAuBE,gBAAAA,UAAU,EAAE;AAAnC,eAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBALF,eAaE,QAAC,UAAD;AAAY,cAAA,OAAO,EAAC,OAApB;AAA4B,cAAA,SAAS,EAAC,GAAtC;AAA0C,cAAA,KAAK,EAAC,eAAhD;AAAgE,cAAA,KAAK,EAAE;AAAEF,gBAAAA,SAAS,EAAE;AAAb,eAAvE;AAAA,wBACG/C,IAAI,CAACP,OAAL,GAAeO,IAAI,CAACP,OAApB,GAA8B;AADjC;AAAA;AAAA;AAAA;AAAA,oBAbF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAVF,eA6BE,QAAC,IAAD;AAAM,UAAA,SAAS,EAAC,QAAhB;AAAA,kCACE,QAAC,MAAD;AACE,YAAA,OAAO,EAAC,UADV;AAEE,YAAA,OAAO,EAAE,MAAM8C,WAAW,CAACvC,IAAI,CAAChB,EAAN,CAAX,GAAuB,KAAM,CAA7B,GAAkCyC,gBAAgB,CAACzB,IAAD,CAFnE;AAGE,YAAA,KAAK,EAAC,WAHR;AAIE,YAAA,SAAS,EAAEuC,WAAW,CAACvC,IAAI,CAAChB,EAAN,CAAX,gBAAuB,QAAC,YAAD;AAAA;AAAA;AAAA;AAAA,oBAAvB,gBAA0C,QAAC,kBAAD;AAAA;AAAA;AAAA;AAAA,oBAJvD;AAKE,YAAA,QAAQ,EAAEuD,WAAW,CAACvC,IAAI,CAAChB,EAAN,CAAX,GAAuB,IAAvB,GAA8B,KAL1C;AAME,YAAA,KAAK,EAAE;AAAE+D,cAAAA,SAAS,EAAE,MAAb;AAAqBG,cAAAA,YAAY,EAAE;AAAnC,aANT;AAAA,sBAQGX,WAAW,CAACvC,IAAI,CAAChB,EAAN,CAAX,GAAuB,OAAvB,GAAiC;AARpC;AAAA;AAAA;AAAA;AAAA,kBADF,eAWE,QAAC,IAAD;AAAM,YAAA,SAAS,MAAf;AAAgB,YAAA,OAAO,EAAC,QAAxB;AAAA,mCACE,QAAC,MAAD;AACE,cAAA,SAAS,EAAE3B,IADb;AAEE,cAAA,EAAE,EAAC,GAFL;AAGE,cAAA,OAAO,EAAC,UAHV;AAIE,cAAA,KAAK,EAAC,WAJR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBAXF;AAAA;AAAA;AAAA;AAAA;AAAA,gBA7BF;AAAA;AAAA;AAAA;AAAA;AAAA;AALF;AAAA;AAAA;AAAA;AAAA,YA7CF,eAsGE,QAAC,YAAD;AACE,MAAA,IAAI,EAAEmD,gBADR;AAEE,MAAA,OAAO,EAAEC,mBAFX;AAGE,MAAA,QAAQ,EAAC,SAHX;AAIE,MAAA,OAAO,EAAC;AAJV;AAAA;AAAA;AAAA;AAAA,YAtGF;AAAA,kBADF;AA+GD,CApOD;;GAAM7B,O;UAEYN,S;;;KAFZM,O;AAsON,eAAeA,OAAf","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\"\nimport { Link } from \"react-router-dom\"\n\nimport { makeStyles, Theme } from \"@material-ui/core/styles\"\nimport { Grid, Typography } from \"@material-ui/core\"\n\nimport Dialog from \"@material-ui/core/Dialog\"\nimport DialogContent from \"@material-ui/core/DialogContent\"\n\nimport Avatar from \"@material-ui/core/Avatar\"\nimport Button from \"@material-ui/core/Button\"\nimport Divider from \"@material-ui/core/Divider\"\nimport FavoriteIcon from \"@material-ui/icons/Favorite\"\nimport FavoriteBorderIcon from \"@material-ui/icons/FavoriteBorder\"\n\nimport AlertMessage from \"components/utils/AlertMessage\"\n\nimport { prefectures } from \"data/prefectures\"\nimport { getUsers } from \"lib/api/users\"\nimport { getLikes, createLike } from \"lib/api/likes\"\nimport { User, Like } from \"interfaces/index\"\n\nimport { AuthContext } from \"App\"\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  avatar: {\n    width: theme.spacing(10),\n    height: theme.spacing(10)\n  }\n}))\n\n// ユーザー一覧ページ\nconst Studies: React.FC = () => {\n  const { currentUser } = useContext(AuthContext)\n  const classes = useStyles()\n\n  const initialUserState: User = {\n    id: 0,\n    uid: \"\",\n    provider: \"\",\n    email: \"\",\n    name: \"\",\n    image: {\n      url: \"\"\n    },\n    gender: 0,\n    birthday: \"\",\n    profile: \"\",\n    prefecture: 13,\n    allowPasswordChange: true\n  }\n\n  const [loading, setLoading] = useState<boolean>(true)\n  const [users, setUsers] = useState<User[]>([])\n  const [user, setUser] = useState<User>(initialUserState)\n  const [userDetailOpen, setUserDetailOpen] = useState<boolean>(false)\n  const [likedUsers, setLikedUsers] = useState<User[]>([])\n  const [likes, setLikes] = useState<Like[]>([])\n  const [alertMessageOpen, setAlertMessageOpen] = useState<boolean>(false)\n\n  // 生年月日から年齢を計算する 年齢 = floor((今日 - 誕生日) / 10000)\n  const userAge = (): number | void => {\n    const birthday = user.birthday.toString().replace(/-/g, \"\")\n    if (birthday.length !== 8) return\n\n    const date = new Date()\n    const today = date.getFullYear() + (\"0\" + (date.getMonth() + 1)).slice(-2) + (\"0\" + date.getDate()).slice(-2)\n\n    return Math.floor((parseInt(today) - parseInt(birthday)) / 10000)\n  }\n\n  // 都道府県\n  const userPrefecture = (): string => {\n    return prefectures[(user.prefecture) - 1]\n  }\n\n  // いいね作成\n  const handleCreateLike = async (user: User) => {\n    const data: Like = {\n      fromUserId: currentUser?.id,\n      toUserId: user.id\n    }\n\n    try {\n      const res = await createLike(data)\n      console.log(res)\n\n      if (res?.status === 200) {\n        setLikes([res.data.like, ...likes])\n        setLikedUsers([user, ...likedUsers])\n\n        console.log(res?.data.like)\n      } else {\n        console.log(\"Failed\")\n      }\n\n      if (res?.data.isMatched === true) {\n        setAlertMessageOpen(true)\n        setUserDetailOpen(false)\n      }\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  // ユーザー一覧を取得\n  const handleGetUsers = async () => {\n    try {\n      const res = await getUsers()\n      console.log(res)\n\n      if (res?.status === 200) {\n        setUsers(res?.data.users)\n      } else {\n        console.log(\"No users\")\n      }\n    } catch (err) {\n      console.log(err)\n    }\n\n    setLoading(false)\n  }\n\n  // いいね一覧を取得\n  const handleGetLikes = async () => {\n    try {\n      const res = await getLikes()\n      console.log(res)\n\n      if (res?.status === 200) {\n        setLikedUsers(res?.data.activeLikes)\n      } else {\n        console.log(\"No likes\")\n      }\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  useEffect(() => {\n    handleGetUsers()\n    handleGetLikes()\n  }, [])\n\n  // すでにいいねを押されているユーザーかどうかの判定\n  const isLikedUser = (userId: number | undefined): boolean => {\n    return likedUsers?.some((likedUser: User) => likedUser.id === userId)\n  }\n\n  return (\n    <>\n      {\n        !loading ? (\n          users?.length > 0 ? (\n            <Grid container justify=\"center\">\n              {\n                users?.map((user: User, index: number) => {\n                  return (\n                    <div key={index} onClick={() => {\n                      setUser(user)\n                      setUserDetailOpen(true)\n                    }}>\n                      <Grid item style={{ margin: \"0.5rem\", cursor: \"pointer\" }}>\n                        <Avatar\n                          alt=\"avatar\"\n                          src={user?.image.url}\n                          className={classes.avatar}\n                        />\n                        <Typography\n                          variant=\"body2\"\n                          component=\"p\"\n                          gutterBottom\n                          style={{ marginTop: \"0.5rem\", textAlign: \"center\" }}\n                        >\n                          {user.name}\n                        </Typography>\n                      </Grid>\n                    </div>\n                  )\n                })\n              }\n            </Grid>\n          ) : (\n            <Typography\n              component=\"p\"\n              variant=\"body2\"\n              color=\"textSecondary\"\n            >\n              まだ1人もユーザーがいません。\n            </Typography>\n          )\n        ) : (\n          <></>\n        )\n      }\n      <Dialog\n        open={userDetailOpen}\n        keepMounted\n        onClose={() => setUserDetailOpen(false)}\n      >\n        <DialogContent>\n          <Grid container justify=\"center\">\n            <Grid item>\n              <Avatar\n                alt=\"avatar\"\n                src={user?.image.url}\n                className={classes.avatar}\n              />\n            </Grid>\n          </Grid>\n          <Grid container justify=\"center\">\n            <Grid item style={{ marginTop: \"1rem\" }}>\n              <Typography variant=\"body1\" component=\"p\" gutterBottom style={{ textAlign: \"center\" }}>\n                {user.name} {userAge()}歳 ({userPrefecture()})\n              </Typography>\n              <Divider />\n              <Typography\n                variant=\"body2\"\n                component=\"p\"\n                gutterBottom\n                style={{ marginTop: \"0.5rem\", fontWeight: \"bold\" }}\n              >\n                自己紹介\n              </Typography>\n              <Typography variant=\"body2\" component=\"p\" color=\"textSecondary\" style={{ marginTop: \"0.5rem\" }}>\n                {user.profile ? user.profile : \"よろしくお願いします。\"}\n              </Typography>\n            </Grid>\n          </Grid>\n          <Grid container=\"center\">\n            <Button\n              variant=\"outlined\"\n              onClick={() => isLikedUser(user.id) ? void (0) : handleCreateLike(user)}\n              color=\"secondary\"\n              startIcon={isLikedUser(user.id) ? <FavoriteIcon /> : <FavoriteBorderIcon />}\n              disabled={isLikedUser(user.id) ? true : false}\n              style={{ marginTop: \"1rem\", marginBottom: \"1rem\" }}\n            >\n              {isLikedUser(user.id) ? \"いいね済み\" : \"いいね\"}\n            </Button>\n            <Grid container justify=\"center\">\n              <Button\n                component={Link}\n                to=\"/\"\n                variant=\"outlined\"\n                color=\"secondary\"\n              > 学習内容を確認する\n            </Button>\n            </Grid>\n          </Grid>\n        </DialogContent>\n      </Dialog>\n      <AlertMessage\n        open={alertMessageOpen}\n        setOpen={setAlertMessageOpen}\n        severity=\"success\"\n        message=\"マッチングが成立しました!\"\n      />\n    </>\n  )\n}\n\nexport default Studies\n"]},"metadata":{},"sourceType":"module"}