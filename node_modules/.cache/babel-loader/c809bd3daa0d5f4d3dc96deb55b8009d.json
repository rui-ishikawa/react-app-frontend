{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/src/components/pages/ChatRoom.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useContext } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Grid, Typography } from \"@material-ui/core\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Box from \"@material-ui/core/Box\";\nimport Button from \"@material-ui/core/Button\";\nimport SendIcon from \"@material-ui/icons/Send\";\nimport { getChatRoom } from \"lib/api/chat_rooms\";\nimport { createMessage } from \"lib/api/messages\";\nimport { AuthContext } from \"App\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  avatar: {\n    width: theme.spacing(10),\n    height: theme.spacing(10),\n    margin: \"0 auto\"\n  },\n  formWrapper: {\n    padding: \"2px 4px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    width: 340\n  },\n  textInputWrapper: {\n    width: \"100%\"\n  },\n  button: {\n    marginLeft: theme.spacing(1)\n  }\n}));\n\n// 個別のチャットルームページ\nconst ChatRoom = props => {\n  _s();\n\n  const classes = useStyles();\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const id = parseInt(props.match.params.id); // URLからidを取得\n\n  const [loading, setLoading] = useState(true);\n  const [otherUser, setOtherUser] = useState();\n  const [messages, setMeesages] = useState([]);\n  const [content, setContent] = useState(\"\");\n  useEffect(() => {\n    async function handleGetChatRoom() {\n      try {\n        const res = await getChatRoom(id);\n        console.log(res);\n\n        if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n          setOtherUser(res === null || res === void 0 ? void 0 : res.data.otherUser);\n          setMeesages(res === null || res === void 0 ? void 0 : res.data.messages);\n        } else {\n          console.log(\"No other user\");\n        }\n      } catch (err) {\n        console.log(err);\n      }\n\n      setLoading(false);\n    }\n\n    handleGetChatRoom();\n  }, [id]);\n\n  const createFormData = () => {\n    const formData = new FormData();\n    formData.append(\"chatRoomId\", id);\n    formData.append(\"userId\", currentUser);\n    formData.append(\"content\", content); // formData.append(\"createdAt\", createdAt)\n\n    return formData;\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault(); // const data: MessageData = {\n    //   chatRoomId: id,\n    //   userId: currentUser?.id, \n    //   content: content\n    // }\n\n    const data = createFormData();\n\n    try {\n      const res = await createMessage(data);\n      console.log(res);\n\n      if (res.status === 200) {\n        setMeesages([...messages, res.data.message]);\n        setContent(\"\");\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }; // Railsから渡ってくるtimestamp（ISO8601）をdatetimeに変換\n\n\n  const iso8601ToDateTime = iso8601 => {\n    const date = new Date(Date.parse(iso8601));\n    const year = date.getFullYear();\n    const month = date.getMonth() + 1;\n    const day = date.getDate();\n    const hour = date.getHours();\n    const minute = date.getMinutes();\n    return year + \"年\" + month + \"月\" + day + \"日\" + hour + \"時\" + minute + \"分\";\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: !loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 360\n      },\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        justifyContent: \"center\",\n        style: {\n          marginBottom: \"1rem\"\n        },\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            alt: \"avatar\",\n            src: (otherUser === null || otherUser === void 0 ? void 0 : otherUser.image.url) || \"\",\n            className: classes.avatar\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            component: \"p\",\n            gutterBottom: true,\n            style: {\n              marginTop: \"0.5rem\",\n              marginBottom: \"1rem\",\n              textAlign: \"center\"\n            },\n            children: otherUser === null || otherUser === void 0 ? void 0 : otherUser.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }, this), messages.map((message, index) => {\n        var _message$createdAt;\n\n        return /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          justifyContent: message.userId === (otherUser === null || otherUser === void 0 ? void 0 : otherUser.id) ? \"flex-start\" : \"flex-end\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              borderRadius: message.userId === (otherUser === null || otherUser === void 0 ? void 0 : otherUser.id) ? \"30px 30px 30px 0px\" : \"30px 30px 0px 30px\",\n              bgcolor: message.userId === (otherUser === null || otherUser === void 0 ? void 0 : otherUser.id) ? \"#d3d3d3\" : \"#ffb6c1\",\n              color: message.userId === (otherUser === null || otherUser === void 0 ? void 0 : otherUser.id) ? \"#000000\" : \"#ffffff\",\n              m: 1,\n              border: 0,\n              style: {\n                padding: \"1rem\"\n              },\n              children: /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body1\",\n                component: \"p\",\n                children: message.content\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              component: \"p\",\n              color: \"textSecondary\",\n              style: {\n                textAlign: message.userId === (otherUser === null || otherUser === void 0 ? void 0 : otherUser.id) ? \"left\" : \"right\"\n              },\n              children: iso8601ToDateTime(((_message$createdAt = message.createdAt) === null || _message$createdAt === void 0 ? void 0 : _message$createdAt.toString()) || \"100000000\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 23\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 21\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 19\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        justifyContent: \"center\",\n        style: {\n          marginTop: \"2rem\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          className: classes.formWrapper,\n          noValidate: true,\n          autoComplete: \"off\",\n          children: [/*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            multiline: true,\n            value: content,\n            onChange: e => setContent(e.target.value),\n            className: classes.textInputWrapper\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            color: \"primary\",\n            disabled: !content ? true : false,\n            onClick: handleSubmit,\n            className: classes.button,\n            children: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 11\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n  }, void 0, false);\n};\n\n_s(ChatRoom, \"BzYLDgjrVvIHNpapPr1lGn5O0Ao=\", false, function () {\n  return [useStyles];\n});\n\n_c = ChatRoom;\nexport default ChatRoom;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatRoom\");","map":{"version":3,"sources":["/usr/src/app/src/components/pages/ChatRoom.tsx"],"names":["React","useEffect","useState","useContext","makeStyles","Grid","Typography","Avatar","TextField","Box","Button","SendIcon","getChatRoom","createMessage","AuthContext","useStyles","theme","avatar","width","spacing","height","margin","formWrapper","padding","display","alignItems","textInputWrapper","button","marginLeft","ChatRoom","props","classes","currentUser","id","parseInt","match","params","loading","setLoading","otherUser","setOtherUser","messages","setMeesages","content","setContent","handleGetChatRoom","res","console","log","status","data","err","createFormData","formData","FormData","append","handleSubmit","e","preventDefault","message","iso8601ToDateTime","iso8601","date","Date","parse","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","maxWidth","marginBottom","image","url","marginTop","textAlign","name","map","index","userId","createdAt","toString","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\"\nimport { RouteComponentProps } from \"react-router-dom\"\n\nimport { makeStyles, Theme } from \"@material-ui/core/styles\"\nimport { Grid, Typography } from \"@material-ui/core\"\nimport Avatar from \"@material-ui/core/Avatar\"\nimport TextField from \"@material-ui/core/TextField\"\nimport Box from \"@material-ui/core/Box\"\nimport Button from \"@material-ui/core/Button\"\nimport SendIcon from \"@material-ui/icons/Send\"\n\nimport { getChatRoom } from \"lib/api/chat_rooms\"\nimport { createMessage } from \"lib/api/messages\"\nimport { User, MessageData } from \"interfaces/index\"\n\nimport { ChatRoomFormData } from \"interfaces/index\"\n\nimport { AuthContext } from \"App\"\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  avatar: {\n    width: theme.spacing(10),\n    height: theme.spacing(10),\n    margin: \"0 auto\"\n  },\n  formWrapper: {\n    padding: \"2px 4px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    width: 340\n  },\n  textInputWrapper: {\n    width: \"100%\"\n  },\n  button: {\n    marginLeft: theme.spacing(1)\n  }\n}))\n\ntype ChatRoomProps = RouteComponentProps<{ id: string }>\n\n// 個別のチャットルームページ\nconst ChatRoom: React.FC<ChatRoomProps> = (props) => {\n  const classes = useStyles()\n\n  const { currentUser } = useContext(AuthContext)\n  const id = parseInt(props.match.params.id) // URLからidを取得\n\n  const [loading, setLoading] = useState<boolean>(true)\n  const [otherUser, setOtherUser] = useState<User>()\n  const [messages, setMeesages] = useState<MessageData[]>([])\n  const [content, setContent] = useState<string>(\"\")\n\n\n\n  useEffect(() => {\n    async function handleGetChatRoom() {\n      try {\n        const res = await getChatRoom(id)\n        console.log(res)\n\n        if (res?.status === 200) {\n          setOtherUser(res?.data.otherUser)\n          setMeesages(res?.data.messages)\n        } else {\n          console.log(\"No other user\")\n        }\n      } catch (err) {\n        console.log(err)\n      }\n\n      setLoading(false)\n    }\n    handleGetChatRoom()\n  }, [id])\n\n  const createFormData = (): ChatRoomFormData => {\n    const formData = new FormData()\n\n    formData.append(\"chatRoomId\", id)\n    formData.append(\"userId\", currentUser)\n    formData.append(\"content\", content)\n    // formData.append(\"createdAt\", createdAt)\n\n    return formData\n  }\n\n  const handleSubmit = async (e: React.MouseEvent<HTMLButtonElement>) => {\n    e.preventDefault()\n\n    // const data: MessageData = {\n    //   chatRoomId: id,\n    //   userId: currentUser?.id, \n    //   content: content\n    // }\n    const data = createFormData()\n\n    try {\n      const res = await createMessage(data)\n      console.log(res)\n\n      if (res.status === 200) {\n        setMeesages([...messages, res.data.message])\n        setContent(\"\")\n      }\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  // Railsから渡ってくるtimestamp（ISO8601）をdatetimeに変換\n  const iso8601ToDateTime = (iso8601: string) => {\n    const date = new Date(Date.parse(iso8601))\n    const year = date.getFullYear()\n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    const hour = date.getHours()\n    const minute = date.getMinutes()\n\n    return year + \"年\" + month + \"月\" + day + \"日\" + hour + \"時\" + minute + \"分\"\n  }\n\n  return (\n    <>\n      {\n        !loading ? (\n          <div style={{ maxWidth: 360 }}>\n            <Grid container justifyContent=\"center\" style={{ marginBottom: \"1rem\" }}>\n              <Grid item>\n                <Avatar\n                  alt=\"avatar\"\n                  src={otherUser?.image.url || \"\"}\n                  className={classes.avatar}\n                />\n                <Typography\n                  variant=\"body2\"\n                  component=\"p\"\n                  gutterBottom\n                  style={{ marginTop: \"0.5rem\", marginBottom: \"1rem\", textAlign: \"center\" }}\n                >\n                  {otherUser?.name}\n                </Typography>\n              </Grid>\n            </Grid>\n            {\n              messages.map((message: MessageData, index: number) => {\n                return (\n                  <Grid key={index} container justifyContent={message.userId === otherUser?.id ? \"flex-start\" : \"flex-end\"}>\n                    <Grid item>\n                      <Box\n                        borderRadius={message.userId === otherUser?.id ? \"30px 30px 30px 0px\" : \"30px 30px 0px 30px\"}\n                        bgcolor={message.userId === otherUser?.id ? \"#d3d3d3\" : \"#ffb6c1\"}\n                        color={message.userId === otherUser?.id ? \"#000000\" : \"#ffffff\"}\n                        m={1}\n                        border={0}\n                        style={{ padding: \"1rem\" }}\n                      >\n                        <Typography variant=\"body1\" component=\"p\">\n                          {message.content}\n                        </Typography>\n                      </Box>\n                      <Typography\n                        variant=\"body2\"\n                        component=\"p\"\n                        color=\"textSecondary\"\n                        style={{ textAlign: message.userId === otherUser?.id ? \"left\" : \"right\" }}\n                      >\n                        {iso8601ToDateTime(message.createdAt?.toString() || \"100000000\")}\n                      </Typography>\n                    </Grid>\n                  </Grid>\n                )\n              })\n            }\n            <Grid container justifyContent=\"center\" style={{ marginTop: \"2rem\" }}>\n              <form className={classes.formWrapper} noValidate autoComplete=\"off\">\n                <TextField\n                  required\n                  multiline\n                  value={content}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => setContent(e.target.value)}\n                  className={classes.textInputWrapper}\n                />\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  disabled={!content ? true : false}\n                  onClick={handleSubmit}\n                  className={classes.button}\n                >\n                  <SendIcon />\n                </Button>\n              </form>\n            </Grid>\n          </div>\n        ) : (\n          <></>\n        )\n      }\n    </>\n  )\n}\n\nexport default ChatRoom\n"]},"metadata":{},"sourceType":"module"}